name: 'Security Results Summary'
description: 'Collect and summarize all security scan results'
inputs:
  trivy-result:
    description: 'Result of Trivy scan'
    required: true
  semgrep-result:
    description: 'Result of Semgrep scan'
    required: true
  python-result:
    description: 'Result of Python security scan'
    required: true
  sbom-result:
    description: 'Result of SBOM generation'
    required: true
  checkov-result:
    description: 'Result of Checkov scan'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Download all security results
      uses: actions/download-artifact@v4
      with:
        pattern: security-results-*
        path: security-results
        merge-multiple: true
      continue-on-error: true

    - name: Generate Security Summary
      shell: bash
      env:
        TRIVY_RESULT: ${{ inputs.trivy-result }}
        SEMGREP_RESULT: ${{ inputs.semgrep-result }}
        CHECKOV_RESULT: ${{ inputs.checkov-result }}
        PYTHON_RESULT: ${{ inputs.python-result }}
        SBOM_RESULT: ${{ inputs.sbom-result }}
      run: |
        echo "# Security Scan Summary" > security-summary.md
        echo "Generated on: $(date)" >> security-summary.md
        echo "" >> security-summary.md

        echo "## Trivy Results" >> security-summary.md
        if [ "$TRIVY_RESULT" == "success" ]; then
          echo "[PASS] Completed successfully" >> security-summary.md
        elif [ "$TRIVY_RESULT" == "failure" ]; then
          echo "[FAIL] Failed with issues" >> security-summary.md
        else
          echo "[WARN] Skipped or cancelled" >> security-summary.md
        fi
        echo "" >> security-summary.md

        echo "## Semgrep Results" >> security-summary.md
        if [ "$SEMGREP_RESULT" == "success" ]; then
          echo "[PASS] Completed successfully" >> security-summary.md
        elif [ "$SEMGREP_RESULT" == "failure" ]; then
          echo "[FAIL] Failed with issues" >> security-summary.md
        else
          echo "[WARN] Skipped or cancelled" >> security-summary.md
        fi
        echo "" >> security-summary.md

        echo "## Python Security Results" >> security-summary.md
        if [ "$PYTHON_RESULT" == "success" ]; then
          echo "[PASS] Completed successfully" >> security-summary.md
        elif [ "$PYTHON_RESULT" == "failure" ]; then
          echo "[FAIL] Failed with issues" >> security-summary.md
        else
          echo "[WARN] Skipped or cancelled" >> security-summary.md
        fi
        echo "" >> security-summary.md

        echo "## SBOM Results" >> security-summary.md
        if [ "$SBOM_RESULT" == "success" ]; then
          echo "[PASS] Completed successfully" >> security-summary.md
        elif [ "$SBOM_RESULT" == "failure" ]; then
          echo "[FAIL] Failed with issues" >> security-summary.md
        else
          echo "[WARN] Skipped or cancelled" >> security-summary.md
        fi
        echo "" >> security-summary.md

        echo "## Checkov Results" >> security-summary.md
        if [ "$CHECKOV_RESULT" == "success" ]; then
          echo "[PASS] Completed successfully" >> security-summary.md
        elif [ "$CHECKOV_RESULT" == "failure" ]; then
          echo "[FAIL] Failed with issues" >> security-summary.md
        else
          echo "[WARN] Skipped or cancelled" >> security-summary.md
        fi

    - name: Upload Security Results
      uses: actions/upload-artifact@v4
      with:
        name: security-results
        path: |
          security-results/
          security-summary.md
        retention-days: 30
