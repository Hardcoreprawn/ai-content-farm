{% extends "minimal/base.html" %}

{% block title %}{{ article.title }} - {{ site.title }}{% endblock %}
{% block description %}{{ article.title }}{% endblock %}

{% block og_title %}{{ article.title }}{% endblock %}
{% block og_description %}{{ article.title }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_url %}/articles/{{ article.slug }}.html{% endblock %}

{% block twitter_title %}{{ article.title }}{% endblock %}
{% block twitter_description %}{{ article.title }}{% endblock %}

{% block body_class %}article{% endblock %}

{% block content %}
<article class="article-full">
    <header class="article-header">
        <div class="article-breadcrumb">
            <a href="/">← Back to Articles</a>
        </div>

        <h1 class="article-title">{{ article.title }}</h1>

        <div class="article-meta-full">
            <div class="meta-row">
                <span class="meta-label">Source:</span>
                <span class="meta-value">{{ article.source }}</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Generated:</span>
                <span class="meta-value">{{ article.generated_at.strftime('%Y-%m-%d %H:%M UTC') }}</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Word Count:</span>
                <span class="meta-value">{{ article.word_count }} words</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Quality Score:</span>
                <span class="meta-value">{{ (article.quality_score * 100)|round }}%</span>
            </div>
            {% if article.cost %}
            <div class="meta-row">
                <span class="meta-label">Generation Cost:</span>
                <span class="meta-value">${{ "%.6f"|format(article.cost) }}</span>
            </div>
            {% endif %}
        </div>
    </header>

    <div class="article-content">
        {% if article.content %}
        <!-- Convert markdown-style content to HTML -->
        {% set content_html = article.content | replace('**', '<strong>') | replace('**', '</strong>') %}
        {% set content_html = content_html | replace('# ', '<h1>') | replace('\n\n', '</h1>\n\n<p>') %}
            {% set content_html = content_html | replace('\n', '</p>\n<p>') %}
            {% if not content_html.startswith('<') %} <p>{{ content_html }}</p>
        {% else %}
        {{ content_html | safe }}
        {% endif %}
        {% else %}
        <p><em>No content available for this article.</em></p>
        {% endif %}
    </div>

    <footer class="article-footer">
        {% if article.original_url %}
        <div class="source-attribution">
            <h4>Source</h4>
            <p>This content was AI-generated based on information from:</p>
            <a href="{{ article.original_url }}" target="_blank" rel="noopener" class="source-link-full">
                {{ article.original_url }}
            </a>
        </div>
        {% endif %}

        <div class="article-actions">
            <a href="/" class="btn btn-primary">← Back to All Articles</a>
            {% if article.original_url %}
            <a href="{{ article.original_url }}" target="_blank" rel="noopener" class="btn btn-secondary">
                Read Original Source →
            </a>
            {% endif %}
        </div>

        <div class="generation-info">
            <h4>About This Article</h4>
            <p>
                This article was automatically generated by AI Content Farm on
                {{ article.generated_at.strftime('%Y-%m-%d at %H:%M UTC') }}.
                It represents an AI interpretation of technology news and should be
                verified against original sources.
            </p>
            <p>
                <strong>Topic ID:</strong> {{ article.topic_id }}<br>
                <strong>Generation Model:</strong> GPT-3.5-turbo<br>
                <strong>Processing Time:</strong> ~8-10 seconds
            </p>
        </div>
    </footer>
</article>

<!-- Related Articles Section (future enhancement) -->
<aside class="related-articles">
    <h3>More Tech News</h3>
    <p><a href="/">View all articles →</a></p>
</aside>
{% endblock %}

{% block scripts %}
<script>
    // Add article-specific JavaScript here
    // Future: Add reading time calculation, social sharing, etc.

    // Calculate estimated reading time
    const wordCount = {{ article.word_count }};
    const wordsPerMinute = 200;
    const readingTime = Math.ceil(wordCount / wordsPerMinute);

    console.log(`Article: ${readingTime} minute read`);
</script>
{% endblock %}
