{% extends "minimal/base.html" %}

{% block title %}{{ article.title }} - {{ site.title }}{% endblock %}
{% block description %}{{ article.title }}{% endblock %}

{% block og_title %}{{ article.title }}{% endblock %}
{% block og_description %}{{ article.title }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_url %}/articles/{{ article.slug }}.html{% endblock %}

{% block twitter_title %}{{ article.title }}{% endblock %}
{% block twitter_description %}{{ article.title }}{% endblock %}

{% block body_class %}article{% endblock %}

{% block content %}
<article class="article-full">
    <header class="article-header">
        <div class="article-breadcrumb">
            <a href="/">← Back to Articles</a>
        </div>

        <h1 class="article-title">{{ article.title }}</h1>

        {% if article.original_url %}
        <div class="source-attribution">
            <h4>Original Source</h4>
            <p>
                <strong>Platform:</strong>
                <a href="{{ article.original_url }}" target="_blank" rel="noopener noreferrer" class="source-link">
                    {{ article.source_platform | default('Web') | title }}
                </a>
                {% if article.source_author %}
                <br><strong>Author:</strong> {{ article.source_author }}
                {% endif %}
                {% if article.original_date %}
                <br><strong>Published:</strong> {{ article.original_date[:10] if article.original_date else 'Unknown' }}
                {% endif %}
            </p>
            <a href="{{ article.original_url }}" class="btn btn-secondary" target="_blank" rel="noopener noreferrer">
                View Original Source →
            </a>
        </div>
        {% endif %}

        <div class="article-meta-full">
            <div class="meta-row">
                <span class="meta-label">Source:</span>
                <span class="meta-value">{{ article.source | default('Unknown') }}</span>
            </div>
            {% if article.generated_at %}
            <div class="meta-row">
                <span class="meta-label">Generated:</span>
                <span class="meta-value">{{ article.generated_at.strftime('%Y-%m-%d %H:%M UTC') }}</span>
            </div>
            {% endif %}
            {% if article.word_count %}
            <div class="meta-row">
                <span class="meta-label">Word Count:</span>
                <span class="meta-value">{{ article.word_count }} words</span>
            </div>
            {% endif %}
            {% if article.quality_score %}
            <div class="meta-row">
                <span class="meta-label">Quality Score:</span>
                <span class="meta-value">{{ (article.quality_score * 100)|round }}%</span>
            </div>
            {% endif %}
            {% if article.cost %}
            <div class="meta-row">
                <span class="meta-label">Generation Cost:</span>
                <span class="meta-value">${{ "%.6f"|format(article.cost) }}</span>
            </div>
            {% endif %}
        </div>
    </header>

    <div class="article-content">
        {% if article.content %}
        <!-- Convert markdown to HTML using proper markdown library -->
        {{ article.content | markdown | safe }}
        {% else %}
        <p><em>No content available for this article.</em></p>
        {% endif %}
    </div>

    <footer class="article-footer">
        {% if article.original_url %}
        <div class="source-attribution">
            <h4>Source</h4>
            <p>This content was AI-generated based on information from:</p>
            <a href="{{ article.original_url }}" target="_blank" rel="noopener" class="source-link-full">
                {{ article.original_url }}
            </a>
        </div>
        {% endif %}

        <div class="article-actions">
            <a href="/" class="btn btn-primary">← Back to All Articles</a>
            {% if article.original_url %}
            <a href="{{ article.original_url }}" target="_blank" rel="noopener" class="btn btn-secondary">
                Read Original Source →
            </a>
            {% endif %}
        </div>

        <div class="generation-info">
            <h4>About This Article</h4>
            <p>
                This article was automatically generated by AI Content Farm{% if article.generated_at %} on
                {{ article.generated_at.strftime('%Y-%m-%d at %H:%M UTC') }}{% endif %}.
                It represents an AI interpretation of technology news and should be
                verified against original sources.
            </p>
            <p>
                {% if article.topic_id %}<strong>Topic ID:</strong> {{ article.topic_id }}<br>{% endif %}
                <strong>Generation Model:</strong> GPT-3.5-turbo<br>
                <strong>Processing Time:</strong> ~8-10 seconds
            </p>
        </div>
    </footer>
</article>

<!-- Related Articles Section (future enhancement) -->
<aside class="related-articles">
    <h3>More Tech News</h3>
    <p><a href="/">View all articles →</a></p>
</aside>
{% endblock %}

{% block scripts %}
<script>
    // Add article-specific JavaScript here
    // Future: Add reading time calculation, social sharing, etc.

    // Calculate estimated reading time
    const wordCount = {{ article.word_count }};
    const wordsPerMinute = 200;
    const readingTime = Math.ceil(wordCount / wordsPerMinute);

    console.log(`Article: ${readingTime} minute read`);
</script>
{% endblock %}
