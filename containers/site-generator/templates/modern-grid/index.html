{% extends "modern-grid/base.html" %}

{% block title %}{{ site.title }} - AI-Curated Tech News{% endblock %}
{% block description %}{{ site.description }} - Latest technology articles curated by AI{% endblock %}
{% block page_type %}home{% endblock %}
{% block body_class %}home-page{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section" role="banner">
    <div class="hero-content">
        <div class="hero-text">
            <h1 class="hero-title">
                <span class="hero-title-main">Latest Tech News</span>
                <span class="hero-title-sub">AI-Curated & Quality-Filtered</span>
            </h1>
            <p class="hero-description">
                Stay ahead with the most important technology stories,
                automatically curated and fact-checked by advanced AI.
            </p>
        </div>

        <div class="hero-stats">
            <div class="stat-card">
                <div class="stat-number">{{ articles|length }}</div>
                <div class="stat-label">Articles</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ (articles|map(attribute='quality_score')|sum / articles|length * 100)|round
                    if articles else 0 }}%</div>
                <div class="stat-label">Avg Quality</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ last_updated.strftime('%H:%M') if last_updated else 'Live' }}</div>
                <div class="stat-label">Last Update</div>
            </div>
        </div>
    </div>

    <!-- Gradient Background -->
    <div class="hero-background">
        <div class="hero-gradient"></div>
        <div class="hero-pattern"></div>
    </div>
</section>

<!-- Filter and Sort Controls -->
<section class="controls-section">
    <div class="controls-container">
        <div class="filter-controls">
            <label for="quality-filter" class="control-label">Quality Filter:</label>
            <select id="quality-filter" class="filter-select">
                <option value="all">All Articles</option>
                <option value="high">High Quality (80%+)</option>
                <option value="premium">Premium (90%+)</option>
            </select>
        </div>

        <div class="sort-controls">
            <label for="sort-select" class="control-label">Sort by:</label>
            <select id="sort-select" class="sort-select">
                <option value="date">Latest First</option>
                <option value="quality">Quality Score</option>
                <option value="length">Article Length</option>
                <option value="source">Source</option>
            </select>
        </div>

        <div class="view-controls">
            <button class="view-toggle" data-view="grid" aria-label="Grid view" title="Grid view">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7" />
                    <rect x="14" y="3" width="7" height="7" />
                    <rect x="3" y="14" width="7" height="7" />
                    <rect x="14" y="14" width="7" height="7" />
                </svg>
            </button>
            <button class="view-toggle active" data-view="cards" aria-label="Card view" title="Card view">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="5" />
                    <rect x="3" y="10" width="18" height="5" />
                    <rect x="3" y="17" width="18" height="5" />
                </svg>
            </button>
        </div>
    </div>
</section>

<!-- Articles Grid -->
<section class="articles-section" role="main">
    {% if articles %}
    <div class="articles-grid" id="articles-container">
        {% for article in articles %}
        <article class="article-card" data-quality="{{ (article.quality_score * 100)|round }}"
            data-source="{{ article.source }}"
            data-date="{{ article.generated_at.isoformat() if article.generated_at else '' }}"
            data-words="{{ article.word_count or 0 }}">

            <!-- Article Header -->
            <header class="article-header">
                <div class="article-meta-top">
                    <span class="article-source">{{ article.source or 'Unknown' }}</span>
                    <div class="article-indicators">
                        {% if article.quality_score and article.quality_score >= 0.9 %}
                        <span class="quality-badge premium" title="Premium Quality (90%+)">‚≠ê</span>
                        {% elif article.quality_score and article.quality_score >= 0.8 %}
                        <span class="quality-badge high" title="High Quality (80%+)">‚ö°</span>
                        {% endif %}

                        {% if article.word_count and article.word_count > 1000 %}
                        <span class="length-badge long" title="Long Read ({{ article.word_count }} words)">üìñ</span>
                        {% endif %}
                    </div>
                </div>

                <h2 class="article-title">
                    <a href="/articles/{{ article.slug }}.html" class="article-link">
                        {{ article.title }}
                    </a>
                </h2>
            </header>

            <!-- Article Preview -->
            <div class="article-preview">
                {% if article.content %}
                <p class="article-excerpt">
                    {{ article.content[:300] }}{% if article.content|length > 300 %}...{% endif %}
                </p>
                {% else %}
                <p class="article-excerpt no-content">
                    Preview not available - click to read the full article.
                </p>
                {% endif %}
            </div>

            <!-- Article Footer -->
            <footer class="article-footer">
                <div class="article-meta">
                    <time class="article-date"
                        datetime="{{ article.generated_at.isoformat() if article.generated_at else '' }}">
                        {{ article.generated_at.strftime('%b %d, %Y') if article.generated_at else 'Recently' }}
                    </time>

                    {% if article.word_count %}
                    <span class="reading-time">
                        {{ ((article.word_count / 200)|round)|int }} min read
                    </span>
                    {% endif %}

                    {% if article.quality_score %}
                    <span class="quality-score" title="AI Quality Score">
                        {{ (article.quality_score * 100)|round }}% quality
                    </span>
                    {% endif %}
                </div>

                <div class="article-actions">
                    {% if article.original_url %}
                    <a href="{{ article.original_url }}" class="source-link" target="_blank" rel="noopener noreferrer"
                        title="View original source">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6" />
                            <polyline points="15,3 21,3 21,9" />
                            <line x1="10" y1="14" x2="21" y2="3" />
                        </svg>
                        Source
                    </a>
                    {% endif %}

                    <a href="/articles/{{ article.slug }}.html" class="read-more-btn">
                        <span>Read Article</span>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
            </footer>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="empty-state">
        <div class="empty-state-content">
            <div class="empty-state-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.35-4.35" />
                </svg>
            </div>
            <h2 class="empty-state-title">No Articles Available</h2>
            <p class="empty-state-description">
                We're currently curating fresh content. Check back soon for the latest tech news!
            </p>
            <a href="/feed.xml" class="empty-state-action">
                Subscribe to RSS for Updates
            </a>
        </div>
    </div>
    {% endif %}
</section>

<!-- Loading State (hidden by default) -->
<div class="loading-state" id="loading-state" aria-hidden="true">
    <div class="loading-spinner"></div>
    <p class="loading-text">Filtering articles...</p>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Article filtering and sorting functionality
    document.addEventListener('DOMContentLoaded', function () {
        const qualityFilter = document.getElementById('quality-filter');
        const sortSelect = document.getElementById('sort-select');
        const viewToggles = document.querySelectorAll('.view-toggle');
        const articlesContainer = document.getElementById('articles-container');
        const loadingState = document.getElementById('loading-state');

        if (!qualityFilter || !sortSelect || !articlesContainer) return;

        // Filter and sort articles
        function updateArticleDisplay() {
            const qualityValue = qualityFilter.value;
            const sortValue = sortSelect.value;
            const articles = Array.from(articlesContainer.querySelectorAll('.article-card'));

            // Show loading
            loadingState.style.display = 'flex';
            articlesContainer.style.opacity = '0.5';

            setTimeout(() => {
                // Filter articles
                articles.forEach(article => {
                    const quality = parseInt(article.dataset.quality) || 0;
                    let show = true;

                    if (qualityValue === 'high' && quality < 80) show = false;
                    if (qualityValue === 'premium' && quality < 90) show = false;

                    article.style.display = show ? 'block' : 'none';
                });

                // Sort visible articles
                const visibleArticles = articles.filter(article => article.style.display !== 'none');

                visibleArticles.sort((a, b) => {
                    switch (sortValue) {
                        case 'quality':
                            return parseInt(b.dataset.quality) - parseInt(a.dataset.quality);
                        case 'length':
                            return parseInt(b.dataset.words) - parseInt(a.dataset.words);
                        case 'source':
                            return a.dataset.source.localeCompare(b.dataset.source);
                        case 'date':
                        default:
                            return new Date(b.dataset.date) - new Date(a.dataset.date);
                    }
                });

                // Reorder DOM elements
                visibleArticles.forEach(article => {
                    articlesContainer.appendChild(article);
                });

                // Hide loading
                loadingState.style.display = 'none';
                articlesContainer.style.opacity = '1';
            }, 300);
        }

        // View toggle functionality
        viewToggles.forEach(toggle => {
            toggle.addEventListener('click', function () {
                viewToggles.forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                const view = this.dataset.view;
                articlesContainer.className = `articles-grid view-${view}`;
            });
        });

        // Event listeners
        qualityFilter.addEventListener('change', updateArticleDisplay);
        sortSelect.addEventListener('change', updateArticleDisplay);
    });
</script>
{% endblock %}
